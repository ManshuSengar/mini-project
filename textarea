import { FormControl, Table, TableBody, TableCell, TableHead, TableRow, TextField } from "@mui/material";
import { FieldArray, Form, Formik } from "formik";
import { useEffect } from "react";
import AutoSave from "../../../components/framework/AutoSave";
import { useAddDisclosuresMutation, useGetDisclosuresByIdQuery, useUpdateDisclosuresMutation } from "../../../features/due-diligence/disclosuresApi";
import * as Yup from 'yup';
const Disclosures = () => {

  const [addDisclosures, addResponse] = useAddDisclosuresMutation();
  const [updateDisclosures, updateResponse] = useUpdateDisclosuresMutation();
  const { data: disclosuresData, isLoading, isError } = useGetDisclosuresByIdQuery(12345); // Replace with actual ID

  const initialValues = {
    disclosure: [
      {
        applId: "12345",
        slNo: 1,
        particulars: "FY",
        tminus1Val: "",
        tminus2Val: "",
        tval: ""
      },
      {
        applId: "12345",
        slNo: 2,
        particulars: "Exposure to real estate",
        tminus1Val: "",
        tminus2Val: "",
        tval: ""
      },
      {
        applId: "12345",
        slNo: 3,
        particulars: "Exposure to capital market",
        tminus1Val: "",
        tminus2Val: "",
        tval: ""
      },
      {
        applId: "12345",
        slNo: 4,
        particulars: "Contingent Liabilities Penalty by RBI",
        tminus1Val: "",
        tminus2Val: "",
        tval: ""
      },
      {
        applId: "12345",
        slNo: 5,
        particulars: "Adverse action by Statutory Auditor/ Bank/FI",
        tminus1Val: "",
        tminus2Val: "",
        tval: ""
      },
      {
        applId: "12345",
        slNo: 6,
        particulars: "Arrears of Statutory Dues",
        tminus1Val: "",
        tminus2Val: "",
        tval: ""
      },
      {
        applId: "12345",
        slNo: 7,
        particulars: "Exposure to Sensitive Sectors",
        tminus1Val: "",
        tminus2Val: "",
        tval: ""
      }
    ],
  };
  const validationSchema = Yup.object().shape({
    disclosure: Yup.array().of(
      Yup.object().shape({
        tminus1Val: Yup.string().required("required"),
        tminus2Val: Yup.string().required("required"),
        tval: Yup.string().required("required"),
      })
    )
  });

  const handleSubmit = async (values: any) => {
    try {
      await updateDisclosures(values.disclosure).unwrap();
    } catch (err) {
      console.error("Error saving discussion lenders:", err);
    }
  };

  return (
    <>
      <div className="wrap-accordian custome-form">
        <Formik
          initialValues={disclosuresData && disclosuresData?.disclosure && disclosuresData?.disclosure.length > 0 ? disclosuresData : initialValues}
          onSubmit={handleSubmit}
          validationSchema={validationSchema}
          validateOnChange={false}
          validateOnBlur={true}
        >
          {({ values }) => (
            <Form>
              <AutoSave debounceMs={2000} />
              <FieldArray name="disclosure">
                {() => (
                  <div className='custome-form'>
                    <div className="wrap-inner-table">
                      <Table sx={{ minWidth: 650 }} aria-label="simple table">
                        <TableHead>
                          <TableRow>
                            <TableCell><b>Particulars</b></TableCell>
                            <TableCell><b>FY
                              <TextField className="ms-2" placeholder="" size="small" type="text" />
                            </b></TableCell>
                            <TableCell><b>FY<TextField className="ms-2" placeholder="" size="small" type="text" /></b></TableCell>
                            <TableCell><b>FY<TextField className="ms-2" placeholder="" size="small" type="text" /></b></TableCell>
                          </TableRow>
                        </TableHead>
                        <TableBody>
                          <TableRow>
                            <TableCell>
                              Exposure to real estate
                            </TableCell>
                            <TableCell>
                              <FormControl fullWidth>
                                <TextField placeholder="" size="small" type="text" />
                              </FormControl>
                            </TableCell>
                            <TableCell>
                              <FormControl fullWidth>
                                <TextField placeholder="" size="small" type="text" />
                              </FormControl>
                            </TableCell>
                            <TableCell>
                              <FormControl fullWidth>
                                <TextField placeholder="" size="small" type="text" />
                              </FormControl>
                            </TableCell>
                          </TableRow>
                          <TableRow>
                            <TableCell>
                              Exposure to capital market
                            </TableCell>
                            <TableCell>
                              <FormControl fullWidth>
                                <TextField placeholder="" size="small" type="text" />
                              </FormControl>
                            </TableCell>
                            <TableCell>
                              <FormControl fullWidth>
                                <TextField placeholder="" size="small" type="text" />
                              </FormControl>
                            </TableCell>
                            <TableCell>
                              <FormControl fullWidth>
                                <TextField placeholder="" size="small" type="text" />
                              </FormControl>
                            </TableCell>
                          </TableRow>
                          <TableRow>
                            <TableCell>
                              Contingent Liabilities Penalty by RBI
                            </TableCell>
                            <TableCell>
                              <FormControl fullWidth>
                                <TextField placeholder="" size="small" type="text" />
                              </FormControl>
                            </TableCell>
                            <TableCell>
                              <FormControl fullWidth>
                                <TextField placeholder="" size="small" type="text" />
                              </FormControl>
                            </TableCell>
                            <TableCell>
                              <FormControl fullWidth>
                                <TextField placeholder="" size="small" type="text" />
                              </FormControl>
                            </TableCell>
                          </TableRow>
                          <TableRow>
                            <TableCell>
                              Adverse action by Statutory Auditor/ Bank/FI
                            </TableCell>
                            <TableCell>
                              <FormControl fullWidth>
                                <TextField placeholder="" size="small" type="text" />
                              </FormControl>
                            </TableCell>
                            <TableCell>
                              <FormControl fullWidth>
                                <TextField placeholder="" size="small" type="text" />
                              </FormControl>
                            </TableCell>
                            <TableCell>
                              <FormControl fullWidth>
                                <TextField placeholder="" size="small" type="text" />
                              </FormControl>
                            </TableCell>
                          </TableRow>
                          <TableRow>
                            <TableCell>
                              Arrears of Statutory Dues
                            </TableCell>
                            <TableCell>
                              <FormControl fullWidth>
                                <TextField placeholder="" size="small" type="text" />
                              </FormControl>
                            </TableCell>
                            <TableCell>
                              <FormControl fullWidth>
                                <TextField placeholder="" size="small" type="text" />
                              </FormControl>
                            </TableCell>
                            <TableCell>
                              <FormControl fullWidth>
                                <TextField placeholder="" size="small" type="text" />
                              </FormControl>
                            </TableCell>
                          </TableRow>
                          <TableRow>
                            <TableCell>
                              Exposure to Sensitive Sectors
                            </TableCell>
                            <TableCell>
                              <FormControl fullWidth>
                                <TextField placeholder="" size="small" type="text" />
                              </FormControl>
                            </TableCell>
                            <TableCell>
                              <FormControl fullWidth>
                                <TextField placeholder="" size="small" type="text" />
                              </FormControl>
                            </TableCell>
                            <TableCell>
                              <FormControl fullWidth>
                                <TextField placeholder="" size="small" type="text" />
                              </FormControl>
                            </TableCell>
                          </TableRow>
                        </TableBody>
                      </Table>
                    </div>
                  </div>
                )}
              </FieldArray>
            </Form>
          )}
        </Formik>
      </div>
    </>
  )
}

export default Disclosures;
